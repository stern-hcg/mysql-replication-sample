## 使用指南

```

### 启动相关容器
docker-compose -f docker-compose.yaml up -d 

### 连接测试,密码配置在env文件中
主库: mysql -h 127.0.0.1 -P 3306 -u root -p
show master status \G;

从库: mysql -h 127.0.0.1 -P 3307 -u root -p
从库: mysql -h 127.0.0.1 -P 3308 -u root -p
show slave status \G;

show databases;
use sakila;
show tables;
select * from customer order by customer_id desc limit 10;
update customer set active=0 where customer_id = 599;


### 发现未成功同步数据
mysql> show slave status\G
显示未开始同步数据

查看master状态
show master status;
然后重新设置slave的相关同步信息
`MYSQL_PWD=${MYSQL_ROOT_PASSWORD} mysql -u root -e "CHANGE MASTER TO MASTER_HOST='mysql-master', MASTER_USER='${MYSQL_REPLICATION_USER}', MASTER_PASSWORD='${MYSQL_REPLICATION_PASSWORD}', MASTER_LOG_FILE='mysql-bin.000004', MASTER_LOG_POS=566;"`

重新启动slave

mysql> start slave;
ERROR 1872 (HY000): Slave failed to initialize relay log info structure from the repository
mysql>  reset slave;
Query OK, 0 rows affected (0.04 sec)

mysql> start slave IO_THREAD;
Query OK, 0 rows affected (0.07 sec)

mysql> stop slave IO_THREAD;
Query OK, 0 rows affected (0.01 sec)

mysql> reset slave;
Query OK, 0 rows affected (0.10 sec)

mysql> start slave;
Query OK, 0 rows affected (0.20 sec)

mysql> show slave status\G

显示连接到master失败

Slave_IO_Running: connecting
Slave_SQL_Running: Yes

error connecting to master 'replication@mysql-master:3306' - retry-time: 60  retries: 1

查看master，发现用户replication授权的host为172.22.0.%，而slave机器所在的网络为172.29.0.%。
修改之后,slave status  
Slave_IO_State: Waiting for master to send event
Slave_IO_Running: Yes
Slave_SQL_Running: Yes

update customer set active=0 where customer_id = 599;

更新之后，发现数据正常的同步到了slave 节点。

重启compose的时候，发现
Slave_SQL_Running: No, 原因是无法创建用户，解决方案参考如下：

https://dba.stackexchange.com/questions/34940/adding-a-user-to-mysql-with-name-fails-with-error-1396

本次实验中，未解决上述错误。

直接重建所有的container。需要删除响应的数据卷，重新启动没有问题。

```